<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="generator"
          content="HTML Tidy for Linux/x86 (vers 25 March 2009), see www.w3.org" />

    <title>{% block title %}Fritz Dect200 Webapp{% endblock title %}</title>
    <meta http-equiv="content-type"
          content="text/html; charset=utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0" />
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css"
          rel="stylesheet"
          type="text/css" />
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"
          type="text/javascript">
</script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"
          type="text/javascript">
</script>
    <link href=
    "//cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.0.0/css/bootstrap3/bootstrap-switch.min.css"
          rel="stylesheet"
          type="text/css" />
    <script src=
    "//cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.0.0/js/bootstrap-switch.min.js"
          type="text/javascript">
</script>
    <link rel="shortcut icon"
          href="/static/favicon.ico"
          type="image/x-icon" />
    <link rel="icon"
          href="/static/favicon.ico"
          type="image/x-icon" />
    <link rel="apple-touch-icon"
          href="/static/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed"
          href="/static/apple-touch-icon.png" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0" />
    <style type="text/css">
/*<![CDATA[*/
    .spinner {
    margin: 100px auto;
    width: 100px;
    height: 100px;
    position: relative;
    }

    .container1 > div, .container2 > div, .container3 > div {
    width: 30px;
    height: 30px;
    background-color: #333;

    border-radius: 100%;
    position: absolute;
    -webkit-animation: bouncedelay 1.2s infinite ease-in-out;
    animation: bouncedelay 1.2s infinite ease-in-out;
    /* Prevent first frame from flickering when animation starts */
    -webkit-animation-fill-mode: both;
    animation-fill-mode: both;
    }

    .spinner .spinner-container {
    position: absolute;
    width: 100%;
    height: 100%;
    }

    .container2 {
    -webkit-transform: rotateZ(45deg);
    transform: rotateZ(45deg);
    }

    .container3 {
    -webkit-transform: rotateZ(90deg);
    transform: rotateZ(90deg);
    }

    .circle1 { top: 0; left: 0; }
    .circle2 { top: 0; right: 0; }
    .circle3 { right: 0; bottom: 0; }
    .circle4 { left: 0; bottom: 0; }

    .container2 .circle1 {
    -webkit-animation-delay: -1.1s;
    animation-delay: -1.1s;
    }

    .container3 .circle1 {
    -webkit-animation-delay: -1.0s;
    animation-delay: -1.0s;
    }

    .container1 .circle2 {
    -webkit-animation-delay: -0.9s;
    animation-delay: -0.9s;
    }

    .container2 .circle2 {
    -webkit-animation-delay: -0.8s;
    animation-delay: -0.8s;
    }

    .container3 .circle2 {
    -webkit-animation-delay: -0.7s;
    animation-delay: -0.7s;
    }

    .container1 .circle3 {
    -webkit-animation-delay: -0.6s;
    animation-delay: -0.6s;
    }

    .container2 .circle3 {
    -webkit-animation-delay: -0.5s;
    animation-delay: -0.5s;
    }

    .container3 .circle3 {
    -webkit-animation-delay: -0.4s;
    animation-delay: -0.4s;
    }

    .container1 .circle4 {
    -webkit-animation-delay: -0.3s;
    animation-delay: -0.3s;
    }

    .container2 .circle4 {
    -webkit-animation-delay: -0.2s;
    animation-delay: -0.2s;
    }

    .container3 .circle4 {
    -webkit-animation-delay: -0.1s;
    animation-delay: -0.1s;
    }

    @-webkit-keyframes bouncedelay {
    0%, 80%, 100% { -webkit-transform: scale(0.0) }
    40% { -webkit-transform: scale(1.0) }
    }

    @keyframes bouncedelay {
    0%, 80%, 100% { 
    transform: scale(0.0);
    -webkit-transform: scale(0.0);
    } 40% { 
    transform: scale(1.0);
    -webkit-transform: scale(1.0);
    }
    }
    /*]]>*/
    </style>
</head>

<body>
    <div class="well">
        <div class="spinner">
            <h2>Laden..</h2>

            <div class="spinner-container container1">
                <div class="circle1"></div>

                <div class="circle2"></div>

                <div class="circle3"></div>

                <div class="circle4"></div>
            </div>

            <div class="spinner-container container2">
                <div class="circle1"></div>

                <div class="circle2"></div>

                <div class="circle3"></div>

                <div class="circle4"></div>
            </div>

            <div class="spinner-container container3">
                <div class="circle1"></div>

                <div class="circle2"></div>

                <div class="circle3"></div>

                <div class="circle4"></div>
            </div>
        </div>

        <div class="alert alert-danger"
             id="fritz-error"></div>

        <div class="switches">
            <div id="switche"></div><button class="btn btn-lg btn-success"
                 onclick="$(':checkbox').bootstrapSwitch('state', true);">alle AN
                 schalten</button>
            <hr />
            <button class="btn btn-lg btn-danger"
                 onclick="$(':checkbox').bootstrapSwitch('state', false);">alle AUS
                 schalten</button>
        </div>
    </div><script type="text/javascript">
//<![CDATA[
    $('.switches').hide();
    $('#fritz-error').hide();
    $.ajax({
        url: "/switch_info",
        data: 'state=info',
        processData: false,
        dataType: "json",
        success:function(a) {
                $('.spinner').hide();
                $('.switches').show();
                jQuery.each(a, function(id) {
                        $('#switche').append('<h2><input type="checkbox" checked id="dev'+ id + '"/> &nbsp; <span onclick="$(\'#dev'+id+'\').bootstrapSwitch(\'toggleState\');" class="label label-info">'+a[id].name+'<\/span><\/h2><span class="label label-success" id="watt'+id+'"><\/span><hr />');
                        $('#dev' + id).bootstrapSwitch('onText', 'An');
                        $('#dev' + id).bootstrapSwitch('offText', 'Aus');
                        $('#dev' + id).bootstrapSwitch('size', 'large');
                });

                jQuery.each(a, function(id) {
                        
                        if (a[id].status == 0) {
                                $('#dev' + id).bootstrapSwitch('state', false);
                        } 
                        else {
                                $('#dev' + id).bootstrapSwitch('state', true);
                        }
                });
                
                $('.switches').show();  
                $(':checkbox').on('switchChange.bootstrapSwitch', function (event, state) {
                        $.ajax({
                                url: "/switch",
                                data: 'state=' + state + '&device=' + event.currentTarget.id,
                                processData: false,
                                dataType: "json",
                                success:function(a) { },
                                error:function() {
                                        $('#fritz-error').append("<p>Es konnte nicht geschaltet werden.<\/p>")
                                }
                        });
                });                     
        },
                error:function() {
                        $('#fritz-error').show();
                        $('#fritz-error').append("<p>Es konnte keine Verbindung zu AVM Dect200 hergestellt werden.<\/p>")
                        }
    });
        

    function get_power() {
        $.ajax({
                url: "/get_power",
                data: '',
                processData: false,
                dataType: "json",
                success:function(a) {             
                        setTimeout(get_power, 15000);
                        jQuery.each(a, function(id) {
                                $('#watt' + id).html(a[id] + " W");
                        });
                },
                error:function() {
                        $('#fritz-error').show();
                        $('#fritz-error').append("<p>Es konnten keine Leistungsdaten der AVM Dect200 Steckdosen ermittelt werden.<\/p>")
                }
        });     
    }
    get_power();

    //]]>
    </script>
</body>
</html>
